!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@ag-grid-community/all-modules"),require("@angular/forms"),require("@angular/common"),require("@angular/common/http"),require("@angular/platform-browser/animations"),require("@angular/router"),require("@ngx-translate/core"),require("@sitmun/frontend-core"),require("@ag-grid-community/angular"),require("@angular/material/button"),require("@angular/material/icon")):"function"==typeof define&&define.amd?define("@sitmun/frontend-gui",["exports","@angular/core","@ag-grid-community/all-modules","@angular/forms","@angular/common","@angular/common/http","@angular/platform-browser/animations","@angular/router","@ngx-translate/core","@sitmun/frontend-core","@ag-grid-community/angular","@angular/material/button","@angular/material/icon"],e):e((t.sitmun=t.sitmun||{},t.sitmun["frontend-gui"]={}),t.ng.core,null,t.ng.forms,t.ng.common,t.ng.common.http,t.ng.platformBrowser.animations,t.ng.router,null,null,null,t.ng.material.button,t.ng.material.icon)}(this,function(t,e,n,o,i,r,a,l,d,s,u,p,c){"use strict";function g(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}var m=(h.prototype.onGridReady=function(t){this.params=t,this.gridApi=t.api,this.gridColumnApi=t.columnApi,this.getElements(),this.gridApi.sizeColumnsToFit();try{for(var e=g(this.columnDefs),n=e.next();!n.done;n=e.next())"estat"===n.value.field&&(this.statusColumn=!0)}catch(r){o={error:r}}finally{try{n&&!n.done&&(i=e["return"])&&i.call(e)}finally{if(o)throw o.error}}var o,i},h.prototype.quickSearch=function(){this.gridApi.setQuickFilter(this.searchValue)},h.prototype.getElements=function(){var e=this;this.getAll().subscribe(function(t){console.log(t),e.rowData=t,setTimeout(function(){e.gridApi.sizeColumnsToFit()},30)})},h.prototype.removeData=function(){this.gridApi.stopEditing(!1);var t,e,n=this.gridApi.getSelectedNodes(),o=n.map(function(t){return t.data});if(this.remove.emit(o),this.statusColumn){var i=n.map(function(t){return t.rowIndex});try{for(var r=g(i),a=r.next();!a.done;a=r.next()){var l=a.value;this.gridApi.getRowNode(l).data.estat="Eliminat"}}catch(d){t={error:d}}finally{try{a&&!a.done&&(e=r["return"])&&e.call(r)}finally{if(t)throw t.error}}this.gridOptions.api.refreshCells()}this.gridOptions.api.deselectAll()},h.prototype.newData=function(){this.gridApi.stopEditing(!1),this["new"].emit(-1)},h.prototype.applyChanges=function(){var t,e,n=[];this.gridApi.stopEditing(!1);try{for(var o=g(this.map.keys()),i=o.next();!i.done;i=o.next()){var r=i.value;n.push(this.gridApi.getRowNode(r).data)}}catch(a){t={error:a}}finally{try{i&&!i.done&&(e=o["return"])&&e.call(o)}finally{if(t)throw t.error}}this.sendChanges.emit(n),this.map.clear(),this.changeCounter=0,this.previousChangeCounter=0,this.redoCounter=0,this.params.colDef.cellStyle={backgroundColor:"#FFFFFF"},this.gridApi.redrawRows()},h.prototype.deleteChanges=function(){for(var t=0;t<this.changeCounter;t++)this.gridApi.undoCellEditing();this.map.clear(),this.previousChangeCounter=0,this.changeCounter=0,this.redoCounter=0,this.params.colDef.cellStyle={backgroundColor:"#FFFFFF"},this.gridApi.redrawRows()},h.prototype.onFilterModified=function(){this.deleteChanges()},h.prototype.undo=function(){this.gridApi.stopEditing(!1),this.gridApi.undoCellEditing(),--this.changeCounter,this.redoCounter+=1},h.prototype.redo=function(){this.gridApi.stopEditing(!1),this.gridApi.redoCellEditing(),this.changeCounter+=1,--this.redoCounter},h.prototype.onCellEditingStopped=function(t){this.modificationChange&&(this.changeCounter++,this.redoCounter=0,this.onCellValueChanged(t),this.modificationChange=!1)},h.prototype.onCellValueChanged=function(t){var e,n;this.params=t,this.changeCounter>this.previousChangeCounter?t.oldValue===t.value||null==t.oldValue&&""===t.value||(this.map.has(t.node.id)?(e=this.map.get(t.node.id),this.map.set(t.node.id,e+1)):this.map.set(t.node.id,1),n=this.gridApi.getDisplayedRowAtIndex(t.rowIndex),t.colDef.cellStyle={backgroundColor:"#E8F1DE"},this.gridApi.redrawRows({rowNodes:[n]}),t.colDef.cellStyle={backgroundColor:"#FFFFFF"},this.previousChangeCounter++):this.changeCounter<this.previousChangeCounter?(1===(e=this.map.get(t.node.id))?(this.map["delete"](t.node.id),n=this.gridApi.getDisplayedRowAtIndex(t.rowIndex),t.colDef.cellStyle={backgroundColor:"#FFFFFF"},this.gridApi.redrawRows({rowNodes:[n]})):1<e&&(this.map.set(t.node.id,e-1),n=this.gridApi.getDisplayedRowAtIndex(t.rowIndex),t.colDef.cellStyle={backgroundColor:"#E8F1DE"},this.gridApi.redrawRows({rowNodes:[n]}),t.colDef.cellStyle={backgroundColor:"#FFFFFF"}),this.previousChangeCounter--):(console.log(t),t.oldValue===t.value||null==t.oldValue&&""===t.value?this.map.has(t.node.id)?(n=this.gridApi.getDisplayedRowAtIndex(t.rowIndex),t.colDef.cellStyle={backgroundColor:"#E8F1DE"},this.gridApi.redrawRows({rowNodes:[n]}),t.colDef.cellStyle={backgroundColor:"#FFFFFF"}):(this.previousChangeCounter++,this.gridApi.undoCellEditing()):this.modificationChange=!0)},h.decorators=[{type:e.Component,args:[{selector:"app-data-grid",template:'    <div id=grup1 class="editDivBtns">\n        <button  mat-mini-fab class="editBtn"  *ngIf="discardChangesButton"  id="borrarCanvis" type="button"  (click)="deleteChanges()" [disabled]="changeCounter <= 0">\n            <mat-icon  fontSet="material-icons-round" > close </mat-icon>\n        </button>\n        <button mat-mini-fab class="editBtn" *ngIf="undoButton"  id="undo"  (click)="undo()" [disabled]="changeCounter <= 0" >\n            <mat-icon fontSet="material-icons-round" > undo </mat-icon>\n        </button>\n        <button mat-mini-fab class="editBtn" *ngIf="redoButton"  id="redo"  (click)="redo()" [disabled]="redoCounter <= 0">\n            <mat-icon fontSet="material-icons-round" > redo </mat-icon>\n        </button>\n        <button mat-mini-fab class="editBtn" *ngIf="applyChangesButton"  id="aplicarCanvis"  (click)="applyChanges()" [disabled]="changeCounter <= 0" >\n            <mat-icon fontSet="material-icons-round" > check </mat-icon>\n        </button>\n    </div>\n\n    <div id=grup2 class="actionsDivBtns" >\n        <label *ngIf="globalSearch" [translate]="\'Search\'"> </label>\n        <input *ngIf="globalSearch"type="text" class="searchGenericInput" placeholder="" (keyup)="quickSearch()" [(ngModel)]="searchValue" ml-2 >\n        <button *ngIf="deleteButton"  mat-stroked-button id="botoElimina"  (click)="removeData()">\n            <mat-icon fontSet="material-icons-round" > delete </mat-icon>\n            <span  [translate]="\'Remove\'"> </span>\n            \n        </button>\n        <button  *ngIf="newButton" mat-stroked-button id="botoNou"  (click)="newData()">\n            <mat-icon fontSet="material-icons-round"> add_circle_outline </mat-icon>      \n            <span  [translate]="\'New\'"> </span>           \n        </button>\n\n\n        \n    </div>\n\n\n\n    <div class="row" style=" height: 100%">\n        <div class="ag-theme-alpine" id="myGrid" style=" width:100%; height: 100%" >\n            <ag-grid-angular\n            style=" width: 100%; height: 100%;"\n            class="ag-theme-alpine"\n            [floatingFilter]="true"\n            [rowData]="rowData"\n            [columnDefs]="columnDefs"\n            [gridOptions]="gridOptions"\n            [animateRows]="true"\n            [pagination]="false"\n            [modules]="modules"     \n            [undoRedoCellEditing]="true"    \n            [undoRedoCellEditingLimit]= 200\n            [suppressRowClickSelection]=true\n            [enableCellChangeFlash]=true\n            [frameworkComponents]="frameworkComponents"\n            rowSelection="multiple"\n            (filterModified)="onFilterModified()"\n            (cellEditingStopped) ="onCellEditingStopped($event)"\n            (cellValueChanged)="onCellValueChanged($event)"\n            (gridReady)="onGridReady($event)">\n            \n            </ag-grid-angular>\n        </div>\n    </div>\n\n\n',styles:["input,label{display:inline-block;margin:5px 5px 5px 10px}#botoNou{color:#fff;background:no-repeat padding-box #68a225;margin-left:3px}#botoElimina{background:no-repeat padding-box #fff;margin-left:3px}#aplicarCanvis{color:#fff!important;background:no-repeat padding-box #68a225;margin-left:3px}#aplicarCanvis[disabled]{background:no-repeat padding-box #83976c}#redo,#undo{color:#fff!important;background:#ff9300;margin-left:3px}#redo[disabled],#undo[disabled]{background:#ffc97f;margin-left:3px}#borrarCanvis{color:#fff!important;background:#df3133}#borrarCanvis[disabled]{color:#fff!important;background:#da8c8e}.editDivBtns{text-align:start;width:20%;height:30px!important;line-height:30px!important}.actionsDivBtns{text-align:end;width:80%;height:60px}.actionsDivBtns,.editDivBtns{display:inline-block!important}.actionsDivBtns .mat-stroked-button{padding:5px 20px!important}.editDivBtns .mat-mini-fab .mat-button-wrapper{padding:inherit!important;display:inherit!important}.editDivBtns .mat-icon{height:30px!important;bottom:5px;position:relative}.editDivBtns .mat-mini-fab{width:30px;height:30px}.actionsDivBtns .searchGenericInput{height:45px!important;width:50%!important}"]}]}],h.ctorParameters=function(){return[]},h.propDecorators={frameworkComponents:[{type:e.Input}],columnDefs:[{type:e.Input}],getAll:[{type:e.Input}],discardChangesButton:[{type:e.Input}],undoButton:[{type:e.Input}],redoButton:[{type:e.Input}],applyChangesButton:[{type:e.Input}],deleteButton:[{type:e.Input}],newButton:[{type:e.Input}],globalSearch:[{type:e.Input}],remove:[{type:e.Output}],"new":[{type:e.Output}],sendChanges:[{type:e.Output}]},h);function h(){this.modules=n.AllCommunityModules,this.statusColumn=!1,this.map=new Map,this.modificationChange=!1,this.remove=new e.EventEmitter,this["new"]=new e.EventEmitter,this.sendChanges=new e.EventEmitter,this.changeCounter=0,this.previousChangeCounter=0,this.redoCounter=0,this.gridOptions={defaultColDef:{sortable:!0,flex:1,filter:!0,editable:!0,cellStyle:{backgroundColor:"#FFFFFF"}},rowSelection:"multiple"}}var f=(C.prototype.agInit=function(t){this.params=t},C.prototype.refresh=function(t){return!0},C.prototype.btnClickedHandler=function(t){this.params.clicked(this.params.value)},C.prototype.getParams=function(){return this.params},C.prototype.ngOnDestroy=function(){},C.decorators=[{type:e.Component,args:[{selector:"app-btn-edit-rendered",template:'<button mat-mini-fab class="buttonEdit"  type="button"  (click)="btnClickedHandler($event)" >\n  <mat-icon class="iconEdit"   fontSet="material-icons-round" > edit </mat-icon>\n</button> ',styles:[".buttonEdit{color:#000;background-color:#ddd;width:24px;height:24px}.iconEdit{font-size:16px;margin-top:-8px}"]}]}],C);function C(){}y.decorators=[{type:e.NgModule,args:[{imports:[l.RouterModule,r.HttpClientModule,i.CommonModule,o.FormsModule,a.NoopAnimationsModule,s.AngularHalModule,o.ReactiveFormsModule,a.BrowserAnimationsModule,u.AgGridModule.withComponents([]),s.SitmunFrontendCoreModule,p.MatButtonModule,c.MatIconModule],declarations:[m,f],entryComponents:[],providers:[],exports:[r.HttpClientModule,i.CommonModule,o.FormsModule,a.NoopAnimationsModule,s.AngularHalModule,d.TranslateModule,o.ReactiveFormsModule,m,s.SitmunFrontendCoreModule]}]}],s=y;function y(){}t.DataGridComponent=m,t.SitmunFrontendGuiModule=s,t.BtnEditRenderedComponent=f,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=sitmun-frontend-gui.umd.min.js.map