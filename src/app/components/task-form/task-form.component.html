<div class="titleDiv">
    <h4><mat-icon aria-hidden="false"  svgIcon="menu_tasques"></mat-icon> {{ "tasksEntity.tasks" | translate }}</h4>
    <span class="divider"></span>
</div>

<div *ngIf="dataLoaded" class="formDiv">
    <form [formGroup]='taskForm' #f="ngForm" (ngSubmit)="onSaveButtonClicked()">

    <div class="formHeader">
        
        <h5> {{properties.form.label | translate}} </h5>
        <button mat-flat-button type="submit"  class="saveButton" >
        <mat-icon fontSet="material-icons-round"> save </mat-icon>
        {{ "save" | translate }}
        </button>
        <button type="button" (click)="utils.navigateBack()"  mat-flat-button class="returnButton"  >
        <mat-icon fontSet="material-icons-round"> arrow_back </mat-icon>
        {{ "return" | translate }}
        </button>
    </div>
    <span class="divider"></span>

    <div *ngFor="let element of formElements; let i = index" >

         <div *ngIf="!element.values.hidden" [ngSwitch]="element.values.control" >  
             
            <div *ngSwitchCase="'input'" >
                <div class="colFormDiv">

                        <label *ngIf="!element.values.condition" [ngClass]="element.values.required?'formLabel requiredInput':'formLabel'" >
                            {{element.values.label | translate}}
                        </label>

                        <label *ngIf="element.values.condition" [ngClass]="element.values.required?'formLabel requiredInput':'formLabel'" >
                            {{getFieldWithCondition(element.values.condition, element.values.label, 'text') }}
                        </label>
                                
                    <mat-form-field appearance="outline">
                        <input matInput type="text" [formControlName]=element.fieldName required>
                    </mat-form-field>

                </div>
            </div>

            <div *ngSwitchCase="'selector'" >
                <div class="colFormDiv">

                    <label *ngIf="!element.values.condition" [ngClass]="element.values.required?'formLabel requiredInput':'formLabel'" >
                        {{element.values.label | translate}}
                    </label>

                    <label *ngIf="element.values.condition" [ngClass]="element.values.required?'formLabel requiredInput':'formLabel'" >
                        {{getFieldWithCondition(element.values.condition, element.values.label, 'text') }}
                    </label>

                    <mat-form-field appearance="outline">
                        <mat-select matInput [formControlName]=element.fieldName class="form-control">
                            <mat-option [value]="dataElement[element.values.selector.value]" *ngFor="let dataElement of getDataSelector(element.values.selector.data)">
                            {{ dataElement[element.values.selector.name]}}
                            </mat-option>
                        </mat-select>
                        </mat-form-field>

                </div>
            </div>

            <div *ngSwitchCase="'checkbox'" >
                <div class="colFormDiv">

                <label *ngIf="!element.values.condition" [ngClass]="element.values.required?'formLabel requiredInput':'formLabel'" >
                    {{element.values.label | translate}}
                </label>

                <label *ngIf="element.values.condition" [ngClass]="element.values.required?'formLabel requiredInput':'formLabel'" >
                    {{getFieldWithCondition(element.values.condition, element.values.label, 'text') }}
                </label>

                    <mat-checkbox  [formControlName]=element.fieldName> </mat-checkbox>

                </div>
            </div>

            <div *ngSwitchCase="'enum'" >
                <div class="colFormDiv">


                <label *ngIf="!element.values.condition" [ngClass]="element.values.required?'formLabel requiredInput':'formLabel'" >
                    {{element.values.label | translate}}
                </label>

                <label *ngIf="element.values.condition" [ngClass]="element.values.required?'formLabel requiredInput':'formLabel'" >
                    {{getFieldWithCondition(element.values.condition, element.values.label, 'text') }}
                </label>

                <mat-radio-group aria-label="Select an option" [formControlName]=element.fieldName>

                    <mat-radio-button *ngFor="let enumElement of element.values.enum.elements;"  class="radioButtonForm"  [value]=enumElement.value> {{ enumElement.label | translate}}</mat-radio-button>

                </mat-radio-group>

                </div>
            </div>

            <div *ngSwitchCase="'selectorPopup'" >
                <div class="colFormDiv marginLeftBtn">


                <label *ngIf="!element.values.condition" [ngClass]="element.values.required?'formLabel requiredInput':'formLabel'" >
                    {{element.values.label | translate}}
                </label>

                <label *ngIf="element.values.condition" [ngClass]="element.values.required?'formLabel requiredInput':'formLabel'" >
                    {{getFieldWithCondition(element.values.condition, element.values.label, 'text') }}
                </label>

                <mat-form-field appearance="outline">
                    <input matInput *ngIf="this.taskForm.value[element.fieldName]"   [readonly]="true" type="text"  [value]="this.taskForm.value[element.fieldName][element.values.selectorPopup.value]" >
                    <input matInput *ngIf="!this.taskForm.value[element.fieldName]" [formControlName]=element.fieldName [readonly]="true" type="text">
                </mat-form-field>
                </div>

                <div class="HalfMidLargeColFormDiv marginLeftBtn">
                    <label class="formLabel">
                      &nbsp;
                    </label>
                    <button type="button" *ngIf="dataLoaded && !this.taskForm.value[element.fieldName]" title="{{ 'add' | translate }}" mat-mini-fab
                      class="mat-green mini-fab " (click)="openPopupDialog(element.fieldName, element.values.selectorPopup.data, element.values.selectorPopup.columns, element.values.label, true, true)">
                      <mat-icon> add </mat-icon>
                    </button>
                    <button type="button" *ngIf="dataLoaded && this.taskForm.value[element.fieldName]" title="{{ 'tasksEntity.modificate' | translate }}"
                      mat-mini-fab class="mat-orange mini-fab" (click)="openPopupDialog(element.fieldName, element.values.selectorPopup.data, element.values.selectorPopup.columns, element.values.label, true, true)">
                      <mat-icon> create </mat-icon>
                    </button>
                    <button type="button" *ngIf="dataLoaded && this.taskForm.value[element.fieldName]"
                      title="{{ 'tasksEntity.deleteCartography' | translate }}" mat-mini-fab class="mat-red mini-fab"
                      (click)="onPopupDeleteButtonClicked(element.fieldName)">
                      <mat-icon> delete </mat-icon>
                    </button>
                  </div>
            </div>



            


         </div>


    </div>


    </form>

</div>



<!-- <div id="task" >


    <form [formGroup]='taskForm' #f="ngForm" id="taskForm" (ngSubmit)="onSaveButtonClicked()">

    </form>

</div> -->

<!-- <div [innerHTML]="htmlString | sanitizeHtml" ></div> -->
<!-- <ng-template #ref></ng-template>  -->

<!-- <ng-container *ngIf="dataLoaded" [ngTemplateOutlet]="tref"> </ng-container> -->

<!-- <div #ref ></div> -->